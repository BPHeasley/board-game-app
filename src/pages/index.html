<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Expandable Board Game List from API</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      color: #2c3e50;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    th, td {
      padding: 12px;
      border: 1px solid #ddd;
      text-align: left;
    }
    th {
      background-color: #f4f4f4;
    }
    .expandable {
      cursor: pointer;
      background-color: #f9f9f9;
    }
    .hiddenRow {
      display: none;
    }
    .expanded {
      background-color: #eaf0f7;
    }
  </style>
</head>
<body>

  <h1>Board Game Application</h1>

  <div>
	<div style="float: left; width: 50%">

	  <!-- Single table for all game titles and expanded rows -->
	  <table id="gameTable">
		<thead>
		  <tr>
			<th>Game Title</th>
			<th>Action</th>
		  </tr>
		</thead>
		<tbody id="gameTitles">
		  <!-- Titles and expandable rows will be inserted dynamically -->
		</tbody>
	  </table>
	</div>

	<div style="float: left; width: 50%">
	  <form id="boardGameForm">
		<table>
		  <tr>
			<td><label for="title">Board Game Name:</label></td>
			<td><input type="text" id="title" name="title" placeholder="Enter the game name..." required></td>
		  </tr>
		  <tr>
		    <td><label for="gameDescription">Game Description:</label></td>
			<td><textarea id="gameDescription" name="gameDescription" placeholder="Enter a brief description..."></textarea></td>
		  </tr>
		  <tr>
		    <td><label for="numPlayers">Number of Players:</label></td>
			<td><input type="number" id="numPlayers" name="numPlayers" placeholder="Enter the number of players..."></td>
		  </tr>
		  <tr>
		    <td><label for="winner">Winner</label></td>
			<td><input type="text" id="winner" name="winner" placeholder="Enter the winner of the game..."></td>
		  </tr>
		  <tr>
			<td><label for="date">Date</label></td>
			<td><input type="date" id="date" name="date" value="2024-10-01" required></td>
		  </tr>
		  <tr>
			<td><input type="submit" value="Submit Game"></td>
		  </tr>
		</table>
	  </form>
	</div>
  </div>

  <script>
	// Skeleton function to make an API call to fetch game data
	async function fetchGameData() {
	  try {
		// Replace with your actual API endpoint
		const response = await fetch("API_GATEWAY_URL/boardgames/");
		const gamesData = await response.json(); // Parse JSON from the API response

		// Ensure data exists
		if (Array.isArray(gamesData)) {
		  populateGameTable(gamesData);
		} else {
		  console.error("Invalid data received from API");
		}
	  } catch (error) {
		console.error("Error fetching game data:", error);
	  }
	}

	// Function to populate the table with game titles and their expandable rows
	function populateGameTable(gamesData) {
	  const gameTitles = [...new Set(gamesData.map(game => game.title))]; // Unique game titles
	  const titleTableBody = document.getElementById('gameTitles');
	  titleTableBody.innerHTML = ""; // clear out contents of the table

	  gameTitles.forEach(title => {
		const row = `<tr class="expandable" data-title="${title}">
		  <td>${title}</td>
		  <td>Click to Expand</td>
		</tr>
		<tr class="hiddenRow" id="details-${title}">
		  <td colspan="2"></td>
		</tr>`;
		titleTableBody.innerHTML += row;
	  });

	  // Attach click events to each expandable row
	  document.querySelectorAll('.expandable').forEach(row => {
		row.addEventListener('click', function() {
		  const selectedTitle = this.getAttribute('data-title');
		  const detailsRow = document.getElementById(`details-${selectedTitle}`);

		  // If already expanded, collapse it
		  if (!detailsRow.classList.contains('hiddenRow')) {
			detailsRow.classList.add('hiddenRow');
			this.classList.remove('expanded');
			detailsRow.querySelector('td').innerHTML = ''; // Clear the content when collapsed
			return;
		  }

		  // Collapse any previously expanded row
		  document.querySelectorAll('.hiddenRow').forEach(r => {
			r.classList.add('hiddenRow');
			r.querySelector('td').innerHTML = ''; // Clear content for other rows
		  });
		  document.querySelectorAll('.expandable').forEach(r => r.classList.remove('expanded'));

		  // Expand the selected row
		  this.classList.add('expanded');
		  detailsRow.classList.remove('hiddenRow');

		  // Filter and display game details for the selected title
		  const gameDetails = gamesData.filter(game => game.title === selectedTitle);
		  let detailContent = `<table width="100%">
			<tr>
			  <th>Title</th>
			  <th>Players</th>
			  <th>Winner</th>
			  <th>Date</th>
			</tr>`;
		  gameDetails.forEach(game => {
			detailContent += `<tr>
			  <td>${game.title}</td>
			  <td>${game.data.players}</td>
			  <td>${game.data.winner}</td>
			  <td>${game.date}</td>
			</tr>`;
		  });
		  detailContent += `</table>`;
		  detailsRow.querySelector('td').innerHTML = detailContent; // Insert the details
		});
	  });
	}

	function titleFilter() {
	var input = document.getElementById("myInput");
	filter = input.value.toUpperCase();
	table = document.getElementById("dataTable");
	tr = table.getElementsByTagName("tr");
	for (i = 0; i < tr.length; i++) {
	  td = tr[i].getElementsByTagName("td")[0];
	  if (td) {
		txtValue = td.innerText;
		if (txtValue.toUpperCase().indexOf(filter) > -1) {
		  tr[i].style.display = "";
		} else {
		  tr[i].style.display = "none";
		}
	  }
	}
  }

  // Form submission
	document.getElementById('boardGameForm').addEventListener('submit', function(event) {
	  event.preventDefault();

	  const gameData = {
		title: document.getElementById('title').value,
		desc: document.getElementById('gameDescription').value,
		players: document.getElementById('numPlayers').value,
		winner: document.getElementById('winner').value,
		date: document.getElementById('date').value
	  };

	  fetch("API_GATEWAY_URL/boardgames/", {
		method: 'POST',
		headers: {
		  'Content-Type': 'application/json',
		  'Access-Control-Allow-Origin': '*'
		},
		body: JSON.stringify(gameData)
	  })
	  .then(response => response.json())
	  .then(data => {
		alert('Game submitted successfully!');
		console.log('Success:', data);
		document.getElementById('boardGameForm').reset()
		fetchGameData();
	  })
	  .catch(error => {
		console.error('Error submitting game:', error);
		alert('Error submitting game.');
	  });
	});

	// Fetch game data on page load
	fetchGameData();
  </script>


</body>
</html>
